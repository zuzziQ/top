<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>GÃ³i 1 VIP</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap');

body {
  margin: 0;
  background: transparent;
  font-family: 'Be Vietnam Pro', sans-serif;
  font-variant-ligatures: none;
}

.box {
  width: 700px;
  padding: 16px;
}

.item {
  font-size: 38px;
  font-weight: 700;
  margin-bottom: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  opacity: 0;
  transform: translateY(10px);
  animation: fadeIn 0.5s forwards;
}

.rank {
  margin-right: 8px;
  color: #ffd700;
}

.amount {
  color: #ffd700;
  min-width: 180px;
  text-align: right;
}

/* ðŸ”¥ Glow when changed */
.glow {
  animation: glow 1.2s ease-in-out infinite alternate;
}

@keyframes glow {
  from {
    text-shadow: 0 0 8px #ffd700;
  }
  to {
    text-shadow: 0 0 20px #ffd700, 0 0 30px #ffea00;
  }
}

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
</head>

<body>
<div class="box" id="list"></div>

<!-- ðŸ”Š Sound -->
<audio id="sound">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
</audio>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbwgkMXvIQ7jmDtoc4TGya_5BTA8fbin4rmQMGWVeK-tVLMfo3gjdbAlyi79CaHwuMmW/exec?type=orders&t=";

const GOI_NAME = "GÃ³i 1";
const MAX_ITEMS = 3;
const REFRESH_MS = 3000;

let lastDataHash = "";

function formatMoney(n) {
  return n.toLocaleString("vi-VN") + "Ä‘";
}

/* ðŸ”¢ Count-up animation */
function animateNumber(el, start, end, duration = 800) {
  const startTime = performance.now();

  function update(now) {
    const progress = Math.min((now - startTime) / duration, 1);
    const value = Math.floor(start + (end - start) * progress);
    el.textContent = formatMoney(value);
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
}

async function loadData() {
  try {
    const res = await fetch(API_URL + Date.now()); // cache-busting
    const json = await res.json();

    const list = document.getElementById("list");
    const data = json[GOI_NAME] || [];

    const hash = JSON.stringify(data);
    const changed = hash !== lastDataHash;
    lastDataHash = hash;

    if (!changed) return;

    list.innerHTML = "";

    if (changed && data.length > 0) {
      document.getElementById("sound").play().catch(() => {});
    }

    data.slice(0, MAX_ITEMS).forEach((item, i) => {
      const row = document.createElement("div");
      row.className = "item glow";

      const name = document.createElement("span");
      name.innerHTML = `<span class="rank">${i + 1}.</span>${item.name}`;

      const amount = document.createElement("span");
      amount.className = "amount";
      amount.textContent = "0Ä‘";

      row.appendChild(name);
      row.appendChild(amount);
      list.appendChild(row);

      animateNumber(amount, 0, item.amount);
    });

  } catch (err) {
    console.error(err);
  }
}

loadData();
setInterval(loadData, REFRESH_MS);
</script>
</body>
</html>
